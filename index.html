<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>malhas26</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0e1116;
      color: #e6e6e6;
      margin: 0;
      padding: 20px;
    }

    h1 {
      margin-bottom: 4px;
    }

    .subtitle {
      color: #9aa4b2;
      margin-bottom: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      background: #141922;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #1f2633;
      font-size: 14px;
      text-align: left;
    }

    th {
      background: #1b2230;
      font-weight: 600;
    }

    tr.category {
      background: #0f1520;
      font-weight: bold;
      color: #7aa2ff;
    }

    .status {
      font-weight: bold;
    }

    .em_execucao { color: #f7c843; }
    .finalizado { color: #3ecf8e; }
    .contingencia { color: #4c82ff; }
    .abend { color: #ff5c5c; }
    .nao_comecou { color: #b48cff; }
    .aguardando_condicao { color: #9aa4b2; }
    .sem_exec { color: #6b7280; }

    .fim-jogo {
      font-size: 18px;
    }

    .obs {
      color: #cbd5f5;
      font-size: 13px;
    }

    footer {
      margin-top: 24px;
      color: #7b8190;
      font-size: 12px;
    }
  </style>
</head>

<body>

<h1>malhas26</h1>
<div class="subtitle">
  Painel read-only. Fonte: <code>malhas.json</code>
</div>

<table>
  <thead>
    <tr>
      <th>Categoria</th>
      <th>Malha</th>
      <th>Status</th>
      <th>Ãšltimo job</th>
      <th>TÃ©rmino real</th>
      <th>Fim de jogo</th>
      <th>ObservaÃ§Ã£o</th>
    </tr>
  </thead>
  <tbody id="tabela-malhas"></tbody>
</table>

<footer>
  âšª = nÃ£o validado | ðŸ”µ = validado â€¢ Sem execuÃ§Ã£o no Odate = sem_exec
</footer>

<script>
/* ===============================
   ORDEM FIXA
================================ */

const ORDEM_CATEGORIAS = [
  "Rotativos",
  "Parcelados",
  "Modelos",
  "GestÃ£o PJ e Alto Risco",
  "Semanal"
];

const ORDEM_MALHAS = {
  "Rotativos": [
    "ORIGENS",
    "ADMISSAO",
    "TETO V2",
    "CMA",
    "GESTAO",
    "CHEQUE",
    "CONCESSAO CARTAO",
    "CONCESSAO CHEQUE",
    "SUPER CREDITO",
    "RENOVACAO LIMITES SEMANAL",
    "OVERLIMIT CLOUD",
    "ATUALIZACAO OVERLIMIT ONLINE MF",
    "OVERLIMIT CARTAO"
  ],
  "Parcelados": [
    "CONSIGNADO",
    "CONSORCIO",
    "CP INVESTIDOR",
    "MICROCREDITO",
    "RX",
    "TH3 â€“ OY",
    "IMOBILIARIO"
  ],
  "Modelos": [
    "BULKLOAD PF ROTATIVOS",
    "CMA PF",
    "DNA",
    "FATURAMENTO",
    "MODELOS PF PARCELADOS",
    "MODELOS PF ROTATIVOS",
    "THR",
    "RENDAS"
  ],
  "GestÃ£o PJ e Alto Risco": [
    "BULKLOAD PRAT CPF_CNPJ",
    "PREVENTIVO PF",
    "LISTA PREV PJ SEMANAL",
    "REDUCAO SEMANAL",
    "REDUCAO MENSAL"
  ],
  "Semanal": [
    "THD SEMANAL",
    "THJ SEMANAL",
    "SUPER CREDITO SEMANAL",
    "OVERLIMIT CHEQUE SEMANAL",
    "RENOVADOR CHEQUE SEMANAL",
    "RX SEMANAL",
    "IMOBILIARIO PREVENTIVO - SEMANAL",
    "STATUS MQ"
  ]
};

/* ===============================
   LOAD + RENDER
================================ */

fetch("./malhas.json")
  .then(res => res.json())
  .then(data => renderTabela(data));

function renderTabela(data) {
  const tbody = document.getElementById("tabela-malhas");
  tbody.innerHTML = "";

  const dia = Object.keys(data.dias)[0];
  const itensDia = data.dias[dia]?.itens || [];

  const mapa = {};
  itensDia.forEach(i => mapa[i.id] = i);

  ORDEM_CATEGORIAS.forEach(cat => {
    const trCat = document.createElement("tr");
    trCat.className = "category";
    trCat.innerHTML = `<td colspan="7">${cat}</td>`;
    tbody.appendChild(trCat);

    ORDEM_MALHAS[cat].forEach(nome => {
      const item = Object.values(mapa).find(m => m.nome === nome) || {
        status: "sem_exec",
        ultimo_job: "-",
        termino_real: "-",
        fim_de_jogo: false,
        observacao: ""
      };

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${cat}</td>
        <td>${nome}</td>
        <td class="status ${item.status}">${item.status}</td>
        <td>${item.ultimo_job || "-"}</td>
        <td>${item.termino_real || "-"}</td>
        <td class="fim-jogo">${item.fim_de_jogo ? "ðŸ”µ" : "âšª"}</td>
        <td class="obs">${item.observacao || "-"}</td>
      `;
      tbody.appendChild(tr);
    });
  });
}
</script>

</body>
</html>
